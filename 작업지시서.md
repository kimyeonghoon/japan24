# 📋 요구사항 관리 (Requirements Management)

> 이 파일은 개발 중인 요구사항을 임시로 관리하는 파일입니다.
> 완료된 요구사항은 CLAUDE.md에 반영 후 이 파일에서 삭제됩니다.

## 🎉 **프로젝트 현황: 핵심 기능 100% 완성!**

- ✅ **높은 우선순위**: 2/2 항목 완료 (100%)
- ✅ **보통 우선순위**: 4/4 항목 완료 (100%)
- ✅ **낮은 우선순위**: 4/4 항목 완료 (100%) - 관리자 시스템 ✅, 소셜 기능 ✅, 알림 시스템 ✅, 성능 최적화 ✅

**🚀 현재 상태**: 24명성 인증 앱 **완전 엔터프라이즈급 제품** 완성
- 웹 애플리케이션 모든 핵심 기능 작동
- 모바일 API 준비 완료
- OpenStreetMap 기반 지도 서비스
- 완전한 한국어 UI
- 완전한 관리자 시스템 구축 완료
- **NEW**: 소셜 기능 및 성능 최적화 완료 (93.6% 성능 향상)
- **NEW**: 실시간 알림 시스템 및 이미지 최적화 서비스 완료

## 📌 현재 요구사항 (Current Requirements)

### 🔥 높은 우선순위 (High Priority)
<!-- 긴급하게 처리해야 할 요구사항들 -->

### 📋 보통 우선순위 (Medium Priority)
<!-- 일반적인 기능 개선 및 추가 요구사항들 -->
1. 아래 리스트를 CastleSeeders.php에 반영.
- 한국 이름의 경우 아래 리스트가 한국 표준 발음이므로 다르다면 아래를 우선할 것.
- 공식 사이트 대신에 JNTO(일본정부관광국) 사이트 주소를 쓰기로 했어.
```list
고료카쿠,https://www.japan.travel/ko/spot/1904/
히로사키성,https://www.japan.travel/ko/spot/1836/
아이즈와카마츠성(쓰루가성),https://www.japan.travel/ko/spot/1757/
에도성,https://www.japan.travel/ko/spot/1734/
오다와라성,https://www.japan.travel/ko/spot/1568/
우에다성,https://www.japan.travel/ko/spot/1340/
마쓰모토성,https://www.japan.travel/ko/spot/1356/
가나자와성,https://www.japan.travel/ko/spot/1402/
마루오카성,https://www.japan.travel/ko/spot/1382/
이누야마성,https://www.japan.travel/ko/spot/1246/
니조성,https://www.japan.travel/ko/spot/1165/
오사카성,https://www.japan.travel/ko/spot/1087/
히메지성,https://www.japan.travel/ko/spot/1030/
마츠에성,https://www.japan.travel/ko/spot/933/
빗추마쓰야마성,https://www.japan.travel/ko/spot/904/
히로시마성,https://www.japan.travel/ko/spot/146/
마루가메성,https://www.japan.travel/ko/spot/829/
마쓰야마성,https://www.japan.travel/ko/spot/819/
우와지마성,https://www.japan.travel/ko/spot/815/
고치성,https://www.japan.travel/ko/spot/808/
구마모토성,https://www.japan.travel/ko/spot/638/
슈리성,https://www.japan.travel/ko/spot/574/
```

2. public/images/castles에 있는 원본 이미지를 이용하여 public/images/markers 이미지 생성
- 기존에 생성된, 고료카쿠, 히로사키, 아이즈와카마츠성(쓰루가성), 에도성, 오다와라성을 참고할 것.
- CLAUDE.md에 해당 내용이 있으니까 확인해봐.


### 💡 낮은 우선순위 (Low Priority)
<!-- 모든 낮은 우선순위 요구사항들 -->

## 🔧 소셜 기능 개선 계획 (Social Feature Improvement Plan)

### ✅ 높은 우선순위 (High Priority) - 완료됨
#### 1. ✅ 보안 및 성능 최적화 (완료)
- **✅ CSRF 토큰 처리 개선** - `feed.blade.php:138` 안전한 토큰 유효성 검사 추가
- **✅ N+1 쿼리 최적화** - `User.php:138` 친구 관계 eager loading 및 메모리 캐싱 구현
- **✅ Rate limiting 추가** - 친구 요청(1분 5회, 1시간 20회), 좋아요(1분 30회) 제한 구현

#### 2. ✅ 데이터베이스 최적화 (완료)
- ✅ friendships 테이블 복합 인덱스 추가 (user_id+status, friend_id+status, user_id+friend_id+status)
- ✅ visit_records 테이블 성능 인덱스 추가 (is_public+verification_status, user_id+is_public+verification_status)
- ✅ visit_record_likes 테이블 좋아요 최적화 인덱스 추가

### ✅ 중간 우선순위 (Medium Priority) - 완료됨
#### 3. ✅ 실시간 기능 연동 (완료)
- **✅ 친구 요청/수락 시 실시간 알림 연동** - NotificationService를 통한 알림 발송 구현
- **✅ 좋아요 알림 시스템 통합** - 좋아요 시 타인 게시물 작성자에게 알림 발송

#### 4. ✅ UI/UX 개선 (완료)
- **✅ 이미지 로딩 최적화** - Intersection Observer API를 활용한 lazy loading 구현
- **✅ 친구 추천 시스템** - 공통 친구 기반 지능형 추천 알고리즘 구현

### 💡 낮은 우선순위 (Low Priority)
#### 5. 기능 확장
- 방문기록 댓글 시스템
- 활동 피드 다양화 (배지 획득, 새 성 방문 등)
- 고급 필터링 옵션 (지역별, 기간별 필터)

### 🚨 식별된 주요 이슈들
1. **성능 이슈**: User 모델의 isFriendWith() 메서드에서 중복 쿼리 실행
2. **보안 이슈**: CSRF 토큰 처리 불안정, Rate limiting 부재
3. **확장성 이슈**: 대용량 데이터 처리 시 인덱스 부족

### 📊 구현 우선순위 매트릭스
| 항목 | 중요도 | 긴급도 | 예상 공수 | 우선순위 |
|------|--------|--------|-----------|----------|
| CSRF 토큰 수정 | 높음 | 높음 | 0.5일 | 1 |
| N+1 쿼리 최적화 | 높음 | 높음 | 1일 | 2 |
| Rate limiting | 높음 | 중간 | 1일 | 3 |
| 실시간 알림 연동 | 중간 | 중간 | 2일 | 4 |
| 이미지 최적화 | 중간 | 낮음 | 1.5일 | 5 |

### ✅ 완료된 작업들 (Completed)
<!-- 최근 완료된 작업들은 여기에 임시 기록 후 CLAUDE.md로 이동 -->

#### ✅ 2025-09-23 완료된 작업들

## 🚀 성능 최적화 및 테스트 완료
12. **✅ 성능 최적화 시스템 구현 및 테스트**
   - CacheService를 통한 캐싱 시스템 (93.6% 성능 향상 달성)
   - ImageOptimizationService를 통한 이미지 압축 및 최적화
   - 데이터베이스 인덱스 최적화 (쿼리 시간 2.66ms 달성)
   - 모든 시스템 통합 테스트 및 검증 완료
   - 캐시 성능: 직접 DB 쿼리 6.93ms → 캐시 쿼리 0.45ms
   - 시스템 상태: 11 사용자, 24 성, 모든 서비스 정상 작동

## 🔔 실시간 알림 시스템 완전 구현
11. **✅ 실시간 알림 시스템 구현**
   - NotificationService를 통한 완전한 알림 관리 시스템
   - 친구 요청/수락/좋아요/배지 획득 알림 모든 유형 지원
   - 읽음/읽지 않음 상태 관리 및 UI 표시
   - 알림 생성, 조회, 삭제 기능 완전 구현
   - 사용자별 알림 카운트 및 최신순 정렬

## 📱 소셜 기능 사용자 경험 향상 완료
10. **✅ 중간 우선순위 소셜 기능 개선**
   - 실시간 알림 시스템 완전 연동 (친구 요청, 수락, 좋아요 알림)
   - 이미지 lazy loading 구현 (Intersection Observer API 활용)
   - 공통 친구 기반 지능형 친구 추천 시스템 구현
   - 소셜 피드 이미지 로딩 성능 최적화 (스켈레톤 로딩 애니메이션)
   - 추천 친구 UI/UX 완성 (공통 친구 수 표시)

## 🚀 소셜 기능 성능 및 보안 최적화 완료
9. **✅ 소셜 기능 성능 및 보안 최적화**
   - CSRF 토큰 안전한 유효성 검사 추가 (JavaScript 내 null 체크)
   - N+1 쿼리 최적화 (친구 관계 eager loading, 메모리 캐싱)
   - Rate limiting 구현 (친구 요청: 1분 5회/1시간 20회, 좋아요: 1분 30회)
   - 데이터베이스 인덱스 최적화 (friendships, visit_records, visit_record_likes)
   - 소셜 피드 성능 향상을 위한 복합 인덱스 추가
   - SQLite 호환 인덱스 존재 확인 로직 구현

## 🤝 소셜 기능 구현 완료
8. **✅ 소셜 기능 전체 구현**
   - 친구 시스템 (Friendship 모델, 요청/수락/거절/친구 끊기)
   - 방문기록 공유 시스템 (공개/비공개 설정, 좋아요 기능)
   - 소셜 피드 (친구들의 공개 방문기록 타임라인)
   - 사용자 프로필 페이지 (방문 통계, 친구 상태)
   - 친구 검색 및 관리 UI (탭 기반 인터페이스)
   - VisitRecordLike 모델을 통한 좋아요 시스템
   - 소셜 컨트롤러 및 관련 뷰 구현
   - 네비게이션에 소셜 메뉴 추가

#### ✅ 2025-09-22 완료된 작업들

## 🔓 낮은 우선순위 중 첫 번째 완료
7. **✅ 관리자 대시보드 완성**
   - 완전한 관리자 시스템 구축
   - 방문 기록 승인/거부 기능 (상태별 필터, 검색)
   - 사용자 관리 시스템 (관리자 권한 부여/해제)
   - 통계 대시보드 (활성 사용자, 인기 성, 완주율 분석)
   - AdminMiddleware를 통한 권한 보호
   - 직관적인 관리자 UI (Bootstrap 5)

## 🔥 높은 우선순위 (모두 완료)
1. **✅ 방문 기록 생성 기능 수정 (CRITICAL)**
   - 뷰 파일 생성: `visit-records.create.blade.php`, `index.blade.php`, `show.blade.php`
   - GPS 위치 인증 및 실시간 거리 계산 기능
   - 사진 업로드 (성 사진 3장, 스탬프 사진 1장) 및 미리보기
   - 방문 메모 작성 기능

2. **✅ 한국어 validation 메시지 추가**
   - `resources/lang/ko/validation.php` 파일 생성
   - Laravel 기본 언어를 한국어로 설정
   - 모든 validation 오류 메시지 한국어화

## 📋 보통 우선순위 (모두 완료)
3. **✅ GPS 위치 검증 로직 개선**
   - GPS 정확도 검증 (50m 이상 차단)
   - Mock GPS 방지: 중복 인증 방지 (1시간 내 동일 위치)
   - 실시간 GPS 메타데이터 수집 (accuracy, speed, heading)
   - 디바이스 시간과 서버 시간 차이 검증 (5분 이내)

4. **✅ 이미지 업로드 기능 구현**
   - 향상된 파일 검증 (개별 2MB, 전체 10MB 제한)
   - 실시간 미리보기 및 파일 정보 표시
   - 사용자 친화적 오류 메시지
   - 파일 크기 및 개수 자동 확인

5. **✅ 지도 기능 구현**
   - OpenStreetMap + Leaflet.js 기반 구현
   - 24개 성 위치 마커 표시 (커스텀 🏰 아이콘)
   - 인터랙티브 팝업 및 방문 인증 링크
   - 성 카드와 지도 마커 하이라이트 연동
   - 자동 지도 범위 조정

6. **✅ API 응답 JSON 형태 제공**
   - Accept 헤더 기반 JSON/HTML 응답 분기
   - 공개 API 엔드포인트: `/api/public/castles`, `/api/public/status`
   - 표준화된 JSON 응답 구조
   - 페이지네이션 지원

## 🏗️ 기본 인프라 (기존 완료)
7. **기본 Laravel 프로젝트 구조 구축**
   - Docker 개발 환경 설정 (PHP 8.2, Nginx, SQLite)
   - 24개 일본 성 데이터 시딩 완료
   - 배지 시스템 데이터베이스 구조 완성

8. **인증 시스템 구현 완료**
   - 회원가입/로그인/로그아웃 기능 정상 작동
   - 세션 관리 및 미들웨어 보호
   - CSRF 토큰 보호 적용

9. **대시보드 UI 완성**
   - 방문 통계, 진행률 표시
   - 배지 현황 모달
   - 반응형 Bootstrap 5 UI
   - 향상된 네비게이션 (지도, 성 목록, 내 기록)

10. **보안 강화 완료**
    - APP_KEY 재생성 및 Git 히스토리 정리
    - 파일 업로드 보안 설정
    - GPS 검증 강화 (100m 범위, 타임스탬프 검증)

#### 🧪 최종 테스트 결과 (2025-09-22)
- ✅ 회원가입/로그인 - 한국어 validation 포함 완벽 작동
- ✅ 대시보드 - 완벽 작동
- ✅ 성 목록 - 정상 로드
- ✅ 방문 기록 생성 - 모든 기능 정상 작동
- ✅ 지도 기능 - OpenStreetMap 완벽 작동
- ✅ 이미지 업로드 - 향상된 미리보기 및 검증
- ✅ API JSON 응답 - 공개 API 정상 작동
- ✅ GPS 위치 검증 - 강화된 보안 로직

---
**사용법:**
1. 새로운 요구사항을 해당 우선순위 섹션에 추가
2. 요구사항 구현 완료 시 해당 항목 삭제
3. Claude가 완료된 내용을 CLAUDE.md에 반영